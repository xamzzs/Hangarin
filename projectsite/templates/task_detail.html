{% extends 'base.html' %}
{% load static %}

{% block title %}{{ task.title }} - Hangarin{% endblock %}
{% block page_title %}Task Details{% endblock %}

{% block content %}
<div class="row">
    <!-- Task Details Card -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <div class="d-flex align-items-center justify-content-between">
                    <h4 class="card-title mb-0"><i class="bi bi-card-text"></i> {{ task.title }}</h4>
                    <div class="btn-group" role="group">
                        <a href="{% url 'task-update' task.pk %}" class="btn btn-sm btn-primary" title="Edit Task">
                            <i class="bi bi-pencil"></i> Edit
                        </a>
                        <a href="{% url 'task-delete' task.pk %}" class="btn btn-sm btn-danger" title="Delete Task">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                        <a href="{% url 'task-list' %}" class="btn btn-sm btn-outline-secondary" title="Back to List">
                            <i class="bi bi-arrow-left"></i> Back
                        </a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!-- Task Description -->
                <div class="mb-4">
                    <h6 class="text-muted mb-2"><i class="bi bi-file-text"></i> Description</h6>
                    <p class="mb-0">{{ task.description|default:"No description provided." }}</p>
                </div>

                <!-- Task Meta Information -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="bi bi-activity"></i> Status</h6>
                            <span class="badge 
                                {% if task.status == 'Pending' %}bg-warning
                                {% elif task.status == 'In Progress' %}bg-primary
                                {% elif task.status == 'Completed' %}bg-success
                                {% endif %}">
                                {{ task.status }}
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="bi bi-exclamation-triangle"></i> Priority</h6>
                            <span class="badge 
                                {% if task.priority.name == 'Low' %}bg-info
                                {% elif task.priority.name == 'Medium' %}bg-warning
                                {% elif task.priority.name == 'High' or task.priority.name == 'Critical' %}bg-danger
                                {% endif %}">
                                {{ task.priority.name }}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="bi bi-folder"></i> Category</h6>
                            <p class="mb-0">{{ task.category.name }}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="bi bi-calendar-event"></i> Deadline</h6>
                            <p class="mb-0">{{ task.deadline|date:"F d, Y" }}</p>
                        </div>
                    </div>
                </div>

                <!-- Timestamps -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="bi bi-calendar-plus"></i> Created At</h6>
                            <p class="mb-0 text-muted small">{{ task.created_at|date:"F d, Y g:i A" }}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="bi bi-calendar-check"></i> Updated At</h6>
                            <p class="mb-0 text-muted small">{{ task.updated_at|date:"F d, Y g:i A" }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar: SubTasks & Notes -->
    <div class="col-md-4">
        <!-- SubTasks Card -->
        <div class="card mb-4">
            <div class="card-header">
                <div class="d-flex align-items-center justify-content-between">
                    <h5 class="card-title mb-0"><i class="bi bi-check-square"></i> SubTasks</h5>
                    <a href="{% url 'subtask-add' task.pk %}" class="btn btn-sm btn-primary" title="Add SubTask">
                        <i class="bi bi-plus"></i>
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if subtasks %}
                    <ul class="list-group list-group-flush">
                        {% for subtask in subtasks %}
                        <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <strong>{{ subtask.title }}</strong>
                                <br>
                                <small class="text-muted">{{ subtask.description|truncatewords:8 }}</small>
                                <br>
                                <span class="badge 
                                    {% if subtask.status == 'Pending' %}bg-warning
                                    {% elif subtask.status == 'In Progress' %}bg-primary
                                    {% elif subtask.status == 'Completed' %}bg-success
                                    {% endif %} mt-1">
                                    {{ subtask.status }}
                                </span>
                            </div>
                            <div class="btn-group-vertical" role="group">
                                <a href="{% url 'subtask-update' subtask.pk %}" class="btn btn-sm btn-outline-primary" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'subtask-delete' subtask.pk %}" class="btn btn-sm btn-outline-danger" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted text-center mb-0">
                        <i class="bi bi-inbox"></i><br>
                        No subtasks yet.
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- Notes Card -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex align-items-center justify-content-between">
                    <h5 class="card-title mb-0"><i class="bi bi-sticky"></i> Notes</h5>
                    <a href="{% url 'note-add' task.pk %}" class="btn btn-sm btn-primary" title="Add Note">
                        <i class="bi bi-plus"></i>
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if notes %}
                    <ul class="list-group list-group-flush">
                        {% for note in notes %}
                        <li class="list-group-item px-0">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <strong>{{ note.title }}</strong>
                                <div class="btn-group" role="group">
                                    <a href="{% url 'note-update' note.pk %}" class="btn btn-sm btn-outline-primary" title="Edit">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a href="{% url 'note-delete' note.pk %}" class="btn btn-sm btn-outline-danger" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </div>
                            </div>
                            <p class="text-muted small mb-1">{{ note.content|truncatewords:15 }}</p>
                            <small class="text-muted"><i class="bi bi-clock"></i> {{ note.created_at|date:"M d, Y" }}</small>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted text-center mb-0">
                        <i class="bi bi-inbox"></i><br>
                        No notes yet.
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
